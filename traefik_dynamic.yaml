#traefik_dynamic.yaml
http:
  routers:
    frontend-service:
      rule: "Host(`dependencyinspection.com`) && PathPrefix(`/`)"
      entryPoints:
        - websecure
      service: "frontend-service"  
      tls:
        certResolver: myresolver
        domains:
          - main: "dependencyinspection.com"
            sans:
              - "www.dependencyinspection.com"
    backend-service:
      rule: "Host(`dependencyinspection.com`) && PathPrefix(`/api`)"
      entryPoints:
        - websecure
      service: "backend-service"  
      tls:
        certResolver: myresolver
        domains:
          - main: "dependencyinspection.com"
            sans:
              - "www.dependencyinspection.com"
  middlewares:
    strip-api-prefix:
      stripPrefix:
        prefixes:
          - "/api"
        # forceSlash: true
    nick-only:
      ipAllowList:
        sourceRange:
          - "107.10.235.119/32"
    www-redirect:
      redirectRegex:
        regex: "https://www.my-site.com/*"
        replacement: "https://sub.my-site.com/*"
  services:
    frontend-service:
      loadbalancer: 
        servers:
          - url: "http://frontend-service:8081"
      middlewares: 
        - www-redirect
      #   - nick-only
    backend-service:
      loadbalancer: 
        servers:
          - url: "http://backend-service:5001"
      middlewares: 
        - www-redirect
      #   - nick-only
      #   - strip-api-prefix
    neo4j-service:
      loadbalancer: 
        servers:
          - url: "http://neo4j-service:7687"
      middlewares: 
        - www-redirect
      #   - nick-only

